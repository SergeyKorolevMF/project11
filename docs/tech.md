# Technical Documentation

## Стек технологий
*   **Language:** Python 3.11+
*   **Framework:** aiogram 3.x (Telegram Bot API)
*   **Database:** SQLite (MVP), PostgreSQL (Future)
*   **ORM:** Tortoise ORM
*   **AI/NLP:** OpenAI API (или аналог) для парсинга текста, выделения сущностей и саммари.
*   **Environment:** `.env` для хранения секретов.

## Архитектура проекта

### Структура директорий
```text
project/
├── bot.py                 # Точка входа (entry point)
├── config.py              # Конфигурация и загрузка переменных окружения
├── database/
│   ├── db.py              # Инициализация Tortoise ORM
│   └── models.py          # Модели данных (User, Person, MeetingNote, etc.)
├── handlers/              # Обработчики команд и сообщений
│   ├── __init__.py
│   ├── common.py          # Общие команды (/start, /help)
│   ├── meetings.py        # Логика добавления встреч/заметок
│   └── reports.py         # Логика управления репортами/людьми
├── keyboards/             # Клавиатуры (inline, reply)
├── middlewares/           # Миддлвари (логирование, проверка прав)
├── services/              # Бизнес-логика и внешние интеграции
│   ├── llm_service.py     # Интеграция с LLM (парсинг заметок)
│   └── todoist_service.py # Интеграция с Todoist (в будущем)
└── utils/                 # Вспомогательные утилиты
```

## Модели данных (Draft)

### User
Пользователь бота (Менеджер).
*   `id`: Telegram ID (PK)
*   `username`: String
*   `created_at`: DateTime

### Person (Report/Context)
Сущность, к которой привязываются встречи (например, сотрудник "Алексей").
*   `id`: UUID (PK)
*   `user_id`: FK -> User
*   `name`: String
*   `is_active`: Boolean

### MeetingNote
Запись о встрече или просто заметка.
*   `id`: UUID (PK)
*   `person_id`: FK -> Person
*   `date`: DateTime
*   `raw_text`: Text (исходный текст заметки)
*   `stress_level`: Int (Optional)
*   `stress_source`: Text (Optional)
*   `rat_of_week`: Text (Optional)
*   `shark_of_week`: Text (Optional)
*   `summary`: Text (Generated by AI)
*   `created_at`: DateTime

### TodoItem
Задачи, извлеченные из заметки.
*   `id`: UUID (PK)
*   `note_id`: FK -> MeetingNote
*   `text`: String
*   `is_completed`: Boolean
*   `todoist_id`: String (Optional, external ID)

## Потоки данных (Data Flow)

1.  **Ввод заметки:**
    User -> Handler -> LLM Service (Parse Structure & Todos) -> Database (Save Note & Todos) -> User (Confirmation).

2.  **Аналитика:**
    User -> Handler -> Database (Query Aggregation) -> Handler (Format Text/Graph) -> User.

